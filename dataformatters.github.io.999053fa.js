const e=document.getElementById("fileUploadArea"),t=document.getElementById("csvFile"),n=document.getElementById("fileStatus"),i=document.getElementById("csvPreview"),o=document.getElementById("mapCsvPreview"),l=document.getElementById("templateSearch");document.getElementById("templateSearchDiv");const a=document.getElementById("templateOptions"),r=document.getElementById("mappingTableBody"),d=document.getElementById("generateButton"),s=document.getElementById("addMappingButton"),m=document.getElementById("errorMessage");let c={firstname:{columnName:"",delimiter:"",position:0},lastname:{columnName:"",delimiter:"",position:0},memberid:{columnName:"",delimiter:"",position:0},gender:{columnName:"",delimiter:"",position:0},dob:{columnName:"",delimiter:"",position:0},pickuptime:{columnName:"",delimiter:"",position:0},dropofftime:{columnName:"",delimiter:"",position:0},tollsamt:{columnName:"",delimiter:"",position:0},congestionfee:{columnName:"",delimiter:"",position:0},mileage:{columnName:"",delimiter:"",position:0},servicetype:{columnName:"",delimiter:"",position:0},authorization:{columnName:"",delimiter:"",position:0},puaddress:{columnName:"",delimiter:"",position:0},pucity:{columnName:"",delimiter:"",position:0},pustate:{columnName:"",delimiter:"",position:0},pickupzip:{columnName:"",delimiter:"",position:0},doaddress:{columnName:"",delimiter:"",position:0},docity:{columnName:"",delimiter:"",position:0},dostate:{columnName:"",delimiter:"",position:0},dropoffzip:{columnName:"",delimiter:"",position:0}},p="",u=[],f=[],h=[],y=null;const g={firstname:{columnNames:[],delimiter:"",position:0},lastname:{columnNames:[],delimiter:"",position:0},memberid:{columnNames:[],delimiter:"",position:0},gender:{columnNames:[],delimiter:"",position:0},dob:{columnNames:[],delimiter:"",position:0},pickuptime:{columnNames:[],delimiter:"",position:0},dropofftime:{columnNames:[],delimiter:"",position:0},tollsamt:{columnNames:[],delimiter:"",position:0},congestionfee:{columnNames:[],delimiter:"",position:0},mileage:{columnNames:[],delimiter:"",position:0},servicetype:{columnNames:[],delimiter:"",position:0},authorization:{columnNames:[],delimiter:"",position:0},puaddress:{columnNames:[],delimiter:"",position:0},pucity:{columnNames:[],delimiter:"",position:0},pustate:{columnNames:[],delimiter:"",position:0},pickupzip:{columnNames:[],delimiter:"",position:0},doaddress:{columnNames:[],delimiter:"",position:0},docity:{columnNames:[],delimiter:"",position:0},dostate:{columnNames:[],delimiter:"",position:0},dropoffzip:{columnNames:[],delimiter:"",position:0}};function v(){let e=t.files[0];if(e&&"text/csv"===e.type){p=e.name,n.textContent=`File selected: ${e.name}`;let t=new FileReader;t.onload=function(e){!function(e){try{let t=e.split("\n").filter(e=>e.trim()),n=t[0].split(",").map(e=>e.trim());f=n;let o={};n.forEach((e,t)=>{o[e]=t+1});let a=t.slice(1).map(e=>e.split(",").map(e=>e.trim()));h=a.slice(0,2),y={headers:n,headersObject:o,rows:a};let r=n.sort().join(","),d=u.find(e=>e.headerSignature===r);if(d)c=d.mapping,l.value=d.name;else{let e={...c};Object.keys(e).forEach(t=>{let n=g[t].columnNames.find(e=>o[e]);n&&(e[t]={columnName:n||"",delimiter:"",position:0})}),c=e}(function(){if(!h||!h.length||!y||!y.headers||!y.headers.length){i.innerHTML="<p>No valid data found in the CSV file.</p>";return}let e="<p>Original Data (First 2 Rows)</p><table><thead><tr>",t=Object.keys(y.headersObject);t.forEach(t=>{e+=`<th>${t}</th>`}),e+="</tr></thead><tbody>",h.forEach(n=>{e+="<tr>",t.forEach(t=>{e+=`<td>${n[y.headersObject[t]-1]||""}</td>`}),e+="</tr>"}),i.innerHTML=e+="</tbody></table>"})(),b(),w(),E()}catch(e){alert("Error processing CSV file. Please check the format.",e.message),console.error("error: ",e)}}(e.target.result)},t.readAsText(e)}else p="",n.textContent="Please select a valid CSV file.",i.innerHTML="<p>CSV preview will appear here after uploading a file.</p>",o.innerHTML="<p>Mapped Data Preview (First 2 Rows) will appear here after configuring the mapping.</p>",y=null,w()}function E(){if(!h||!h.length||!y||!y.headers||!y.headers.length||!L()){o.innerHTML="<p>Mapped Data Preview (First 2 Rows) will appear here after configuring the mapping.</p>";return}try{m.style.display="none";let e=Object.keys(c),t="<p>Mapped Data (First 2 Rows)</p><table><thead><tr>";e.forEach(e=>{t+=`<th>${e.replace(/_/g," ")}</th>`}),t+="</tr></thead><tbody>",h.forEach(n=>{t+="<tr>",e.forEach(e=>{let i=c[e],o=n[y.headersObject[i.columnName]-1]||"",l=o.split(i.delimiter||null),a=parseInt(i.position)||0;o=l.length>a?l[a].trim():"",t+=`<td>${o||""}</td>`}),t+="</tr>"}),o.innerHTML=t+="</tbody></table>"}catch(e){m.textContent=`An error occurred: ${e.message}`,m.style.display="block",alert(`An error occurred: ${e.message}`),console.error("error: ",e)}}function b(e=!1){if(!y||!y.rows||!y.rows.length){r.innerHTML='<tr><td colspan="5">No valid data found in the CSV file.</td></tr>';return}r.innerHTML="",Object.keys(c).forEach(e=>{N(e)})}function N(e,t=!1){let n=c[e],i=document.createElement("tr"),o=document.createElement("td");o.textContent=e.replace(/_/g," "),i.appendChild(o);let l=document.createElement("td"),a=document.createElement("div");a.classList.add("search-container-mapping"),a.setAttribute("data-field",e);let d=document.createElement("input");d.type="text",d.classList.add("search-input-mapping"),d.placeholder="Search for a column...",d.value=n.columnName,a.appendChild(d);let s=document.createElement("div");s.classList.add("searchable-dropdown"),a.appendChild(s);let m=document.createElement("div");m.classList.add("dropdown-content"),m.style.width="200px",s.appendChild(m),y.headers.forEach(e=>{let t=document.createElement("div");t.classList.add("dropdown-item"),t.setAttribute("data-value",e),t.textContent=e,m.appendChild(t)}),d.addEventListener("focus",()=>{m.style.display="block"}),d.addEventListener("input",()=>{let t=d.value.toLowerCase().trim();m.querySelectorAll(".dropdown-item").forEach(e=>{let n=e.textContent.toLowerCase();e.style.display=n.includes(t)?"block":"none"}),m.style.display="block",t||(n.columnName=t,C(i,e),w())}),document.addEventListener("click",e=>{d.contains(e.target)||m.contains(e.target)||(m.style.display="none")}),m.addEventListener("click",t=>{t.target.classList.contains("dropdown-item")&&(d.value=t.target.textContent,n.columnName=d.value,m.style.display="none",C(i,e),w())}),l.appendChild(a),i.appendChild(l);let p=document.createElement("td"),u=document.createElement("input");u.type="text",u.classList.add("delimiter-input"),u.placeholder="e.g. ,",u.value=n.delimiter,u.addEventListener("input",()=>{n.delimiter=u.value,C(i,e)}),p.appendChild(u),i.appendChild(p);let f=document.createElement("td"),h=document.createElement("input");h.type="number",h.min="0",h.value=n.position,h.classList.add("position-input"),h.addEventListener("input",()=>{n.position=parseInt(h.value),C(i,e)}),f.appendChild(h),i.appendChild(f);let g=document.createElement("td");g.classList.add("preview-value"),g.textContent="No preview available",i.appendChild(g),t?r.prepend(i):r.appendChild(i),C(i,e)}function C(e,t){if(!y||!y.rows||!y.rows.length)return;E();let n=e.querySelector(".search-input-mapping").value,i=e.querySelector(".delimiter-input").value,o=parseInt(e.querySelector(".position-input").value)||0,l=e.querySelector(".preview-value");if(!n){l.textContent="No source selected";return}let a=y.rows[0],r=y.headersObject[n];if(!r){l.textContent="Invalid source value";return}let d=a[r-1]||"";if(!d){l.textContent="No data available";return}let s=d.split(i||null),m=parseInt(o)||0;l.textContent=s.length>m?s[m].trim():""}function w(){let e=y&&y.rows&&y.rows.length,t=L();s.disabled=!e,k.disabled=!e,d.disabled=!(e&&t)}function L(){let e=document.querySelectorAll(".search-input-mapping"),t=!1;return e.forEach(e=>{e.value.trim()&&(t=!0)}),t}e.addEventListener("dragover",t=>{t.preventDefault(),e.style.borderColor="#4299e1",e.style.backgroundColor="#e6f7ff"}),e.addEventListener("dragleave",()=>{e.style.borderColor="#cbd5e0",e.style.backgroundColor="#ebf8ff"}),e.addEventListener("drop",n=>{n.preventDefault(),e.style.borderColor="#cbd5e0",e.style.backgroundColor="#ebf8ff",n.dataTransfer.files.length&&(t.files=n.dataTransfer.files,v())}),t.addEventListener("change",v),l.addEventListener("focus",()=>{"Please input template name"===l.placeholder?l.placeholder="":a.style.display="block"}),l.addEventListener("input",()=>{l.placeholder="Search for a template...";let e=l.value.toLowerCase();a.querySelectorAll(".dropdown-item").forEach(t=>{let n=t.textContent.toLowerCase();t.style.display=n.includes(e)?"block":"none"}),a.style.display="block"}),document.addEventListener("click",e=>{l.contains(e.target)||a.contains(e.target)||(a.style.display="none")}),a.addEventListener("click",e=>{if(e.target.classList.contains("dropdown-item")){let t=parseInt(e.target.getAttribute("data-value"));l.value=e.target.textContent,a.style.display="none",c=(u[t]||{}).mapping,b(),w(),E()}}),d.addEventListener("click",function(){if(!y||!y.rows||!y.rows.length){alert("Please upload a CSV file first","error");return}if(!l.value.trim()){l.focus(),l.placeholder="Please input template name",alert("Please provide a name for this template","error");return}try{m.style.display="none";let{headersObject:e,rows:t}=y,n=t.map(t=>{let n=[];return Object.keys(c).forEach(i=>{let o=c[i],l=t[e[o.columnName]-1]||"",a=l.split(o.delimiter||null),r=parseInt(o.position)||0;l=a.length>r?a[r].trim():"",n.push(l)}),n.join(",")}),i=[Object.keys(c).join(","),...n].join("\n"),o=new Blob([i],{type:"text/csv"}),a=URL.createObjectURL(o),r=document.createElement("a");r.href=a,r.download=`mapped_${p}`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a),function(){let e,t=f.sort().join(","),n=u.findIndex(e=>e.name===l.value.trim()),i={name:l.value.trim(),mapping:c,headerSignature:t,createdAt:new Date().toISOString()};n>=0?(e=[...u])[n]=i:e=[...u,i],u=e,localStorage.setItem("csvMappingConfigurations",JSON.stringify(e))}()}catch(e){m.textContent=`An error occurred: ${e.message}`,m.style.display="block",alert(`An error occurred: ${e.message}`),console.error("error: ",e)}}),window.addEventListener("load",()=>{try{let e=localStorage.getItem("csvMappingConfigurations");e&&(u=JSON.parse(e))&&u.forEach((e,t)=>{let n=document.createElement("div");n.classList.add("dropdown-item"),n.setAttribute("data-value",t),n.textContent=e.name,a.appendChild(n)})}catch(e){alert(`An error occurred: ${e.message}`),console.error("error: ",e)}});const k=document.getElementById("showPopupButton"),I=document.getElementById("myPopup"),S=document.getElementById("popupInput");k.addEventListener("click",()=>{I.style.display="flex",S.focus()}),s.addEventListener("click",()=>{I.style.display="none";let e=S.value;c[e]={columnName:"",delimiter:"",position:0},g[e]={columnNames:[],delimiter:"",position:0},N(e,!0),S.value=""}),window.addEventListener("click",e=>{e.target===I&&(I.style.display="none",S.value="")});
//# sourceMappingURL=dataformatters.github.io.999053fa.js.map
